[
~[tlist_sql;
	SELECT 
        U_CDOL_STAFF_CHANGES.id,
		U_CDOL_STAFF_CHANGES.schoolid,
		CASE 
			WHEN U_CDOL_STAFF_CHANGES.schoolid = 0 THEN 'Diocesan Office' 
        	ELSE SCHOOLS.NAME
        END, 
		U_CDOL_STAFF_CHANGES.yearid,
		U_CDOL_STAFF_CHANGES.title, 
		U_CDOL_STAFF_CHANGES.first_name, 
		U_CDOL_STAFF_CHANGES.middle_name, 
		U_CDOL_STAFF_CHANGES.last_name,
		U_CDOL_STAFF_CHANGES.preferred_name,
		U_CDOL_STAFF_CHANGES.maiden_name,
		U_CDOL_STAFF_CHANGES.gender,
		U_CDOL_STAFF_CHANGES.personal_email,
		U_CDOL_STAFF_CHANGES.staff_type,
		U_CDOL_STAFF_CHANGES.position,
		U_CDOL_STAFF_CHANGES.replacing,
		replaced.last_name ||', ' || replaced.first_name as replacedstaff,
		U_CDOL_STAFF_CHANGES.start_date,
		U_CDOL_STAFF_CHANGES.previous,
		U_CDOL_STAFF_CHANGES.previous_employer,
		U_CDOL_STAFF_CHANGES.previous_employer_other,
		U_CDOL_STAFF_CHANGES.submission_date,
		U_CDOL_STAFF_CHANGES.who_submitted,
		submitted.last_name ||', ' || submitted.first_name as submittedstaff,
		U_CDOL_STAFF_CHANGES.ps_created,
		U_CDOL_STAFF_CHANGES.ad_created
    FROM U_CDOL_STAFF_CHANGES
	LEFT OUTER JOIN SCHOOLS ON 
    U_CDOL_STAFF_CHANGES.schoolid = SCHOOLS.school_number
    LEFT OUTER JOIN USERS replaced ON
    to_char(replaced.DCID) = to_char(U_CDOL_STAFF_CHANGES.replacing)
    LEFT OUTER JOIN USERS submitted ON
    to_char(submitted.DCID) = to_char(U_CDOL_STAFF_CHANGES.who_submitted)
	WHERE U_CDOL_STAFF_CHANGES.yearid = ~(gpv.curYearId)
	~[if.is.a.school] AND U_CDOL_STAFF_CHANGES.schoolid=~(gpv.curSchoolId) [/if]
	ORDER BY U_CDOL_STAFF_CHANGES.submission_date DESC, U_CDOL_STAFF_CHANGES.last_name
;]
	{
		"staffid":"~(staffid)",
		"schoolid":"~(schoolid)",
		"schname":"~(schname;JSON)",
		"yearid":"~(yearid)",
		"title":"~(title;JSON)",
		"first_name":"~(first_name;JSON)",
		"middle_name":"~(middle_name;JSON)",
		"last_name":"~(last_name;JSON)",
		"preferred_name":"~(preferred_name;JSON)",
		"maiden_name":"~(maiden_name;JSON)",
		"gender":"~(gender;JSON)",
		"personal_email":"~(personal_email;JSON)",
		"staff_type":"~(staff_type;JSON)",
		"position":"~(position;JSON)",
		"replacingid":"~(replacingid)",
		"replacedstaff":"~(replacedstaff;JSON)",
		"start_date":"~(start_date;d)",
		"previous":"~(previous;JSON)",
		"previous_employer":"~(previous_employer;JSON)",
		"previous_employer_other":"~(previous_employer_other;JSON)",
		"submission_date":"~(submission_date;d)",
		"who_submitted":"~(who_submitted;JSON)",
		"submittedstaff":"~(submittedstaff;JSON)",
		"ps_created":"~(ps_created;JSON)",
		"ad_created":"~(ad_created;JSON)"
	},
[/tlist_sql]
{}]