~[tlist_sql;
    SELECT 
        json_arrayagg(
            json_object(
                'identifier' VALUE users_dcid,
                'title' VALUE title,
                'first_name' VALUE first_name,
                'last_name' VALUE last_name,
                'email_addr' VALUE email_addr,
                'license_microsoft' VALUE license_microsoft,
                'homeschoolid' VALUE homeschoolid,
                'homeschoolname' VALUE homeschoolname,
                'staff_status' VALUE staff_status
                RETURNING CLOB
            )
            RETURNING CLOB
    )
    FROM (
        SELECT
            users.dcid AS users_dcid,
            users.title,
            users.first_name,
            users.last_name,
            users.email_addr,
            u_users_additional_info.license_microsoft,
            users.homeschoolid,
            CASE WHEN schools.name IS NULL THEN 'Diocesan Office' ELSE schools.name END AS homeschoolname,
            schoolstaff.status AS staff_status,
            ROW_NUMBER() OVER (
                PARTITION BY users.dcid, users.first_name, users.last_name
                ORDER BY 
                    CASE WHEN schoolstaff.status = 1 THEN 0 ELSE 1 END,
                    schoolstaff.dcid DESC
            ) AS rn
        FROM 
            schoolstaff
        INNER JOIN users
            ON users.dcid = schoolstaff.users_dcid
        LEFT JOIN schools 
            ON users.homeschoolid = schools.school_number
        LEFT JOIN u_users_additional_info 
            ON users.dcid = u_users_additional_info.usersdcid
        WHERE 
            schoolstaff.status IN (1, 2)
            AND (users.homeschoolid = '~(gpv.curSchoolID)' OR '~(gpv.curSchoolID)' = 0)
            AND users.dcid NOT IN (1,5,5858,5859,5907)
        ) filtered
    WHERE rn = 1
]~(data)[/tlist_sql]